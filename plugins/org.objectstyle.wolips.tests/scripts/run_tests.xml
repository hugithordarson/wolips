<project name="Automated WOLips Testing" default="all"  basedir="." >

	<!--properties file containing the plugin directory name including version number-->
	<property file="test.properties"/>

	<!--name that can be added to report name to identify which platform tests results come from-->
	<property name="platform" value=""/>

	
	<!-- The directory that will contain the xml and html results from the tests that are run -->
 	<property name="results" value="../../../../${build.output.test.dir}/results" />

	<target name="runtests" description="Runs ant on the test.xml for a specified plugin.  Requires a property value setting for testPlugin only if test.properties is not available.  The property testPlugin represents a directory name made up of the plugin id and plugin version.  This directory must contain a valid test.xml.">
        <ant antfile="${param.eclipse.home}/plugins/${testPlugin}_${build.version}/test.xml" dir="${param.eclipse.home}">
            <property name="param.eclipse.home" value="${param.eclipse.home}"/>
        </ant>
		<copy file="${param.eclipse.home}/${report}.xml" tofile="${results}/xml/${report}_${platform}.xml"/>
        <delete file="${param.eclipse.home}/${report}.xml"/>
	</target>

	<target name="wolips" description="Runs the org.objectstyle.wolips.tests test.xml">
		<antcall target="runtests">
			<param name="testPlugin" value="${org.objectstyle.wolips.tests}"/>
			<param name="report" value="org.objectstyle.wolips.tests"/>
		</antcall>
	</target>

    <!-- ============================================= -->
    <!-- Launches the test runs                        -->
    <!-- Required parameters                           -->
    <!-- param.eclipse.home the eclipse home directory -->
    <!-- ============================================= -->
	<target name="all">
	    <antcall target="wolips"/>
	</target>
	
	<target name="genHtml" description="Generates HTML results with provided JUNIT.XSL provided">
		<style style="JUNIT.XSL" basedir="${results}/xml" destdir="${results}/html"/>
	</target>
	
</project>
